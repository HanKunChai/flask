history = model.fit_generator(generate_arrays_from_file(lines[:num_train], batch_size),
                                  steps_per_epoch=max(1, num_train // batch_size),
                                  validation_data=generate_arrays_from_file(lines[num_train:], batch_size),
                                  validation_steps=max(1, num_val // batch_size),
                                  epochs=200,
                                  initial_epoch=0,
                                  callbacks=[checkpoint_period1, reduce_lr])
    with open('log_with_Stren.txt', 'wb') as file_txt:
        pickle.dump(history.history, file_txt)
    model.save_weights(final_weights_path + 'Apple_AlexNet_Stre.h5')